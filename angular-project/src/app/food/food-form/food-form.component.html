<div class="language-toggle">
  <h3>FR</h3>
  <mat-slide-toggle
    [(ngModel)]="isFrench"
    (change)="toggleLanguage()"
  ></mat-slide-toggle>
  <h3>EN</h3>
</div>

<form [formGroup]="foodForm" (ngSubmit)="onSubmit()" class="food-form">
  <div class="form-container mat-elevation-z8">
    <mat-form-field appearance="fill">
      <mat-label>{{ "FOOD_FORM.NAME" | translate }}</mat-label>
      <input
        matInput
        formControlName="name"
        placeholder="{{ 'FOOD_FORM.NAME_PLACEHOLDER' | translate }}"
      />
      <mat-error
        *ngIf="foodForm.get('name').invalid && foodForm.get('name').touched"
      >
        {{ "FOOD_FORM.NAME" | translate }} is required
      </mat-error>
    </mat-form-field>

    <div formGroupName="image" class="image-group">
      <mat-form-field appearance="fill">
        <mat-label>{{ "FOOD_FORM.IMAGE_COVER" | translate }}</mat-label>
        <input
          matInput
          formControlName="cover"
          placeholder="{{ 'FOOD_FORM.IMAGE_COVER_PLACEHOLDER' | translate }}"
        />
        <mat-error *ngIf="foodForm.get('image.cover').hasError('required')">
          {{ "FOOD_FORM.IMAGE_COVER" | translate }} is required
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>{{ "FOOD_FORM.IMAGE_PREVIEW" | translate }}</mat-label>
        <input
          matInput
          formControlName="preview"
          placeholder="{{ 'FOOD_FORM.IMAGE_PREVIEW_PLACEHOLDER' | translate }}"
        />
        <mat-hint>{{ "FOOD_FORM.IMAGE_PREVIEW_HINT" | translate }}</mat-hint>
        <mat-error *ngIf="foodForm.get('image.preview').hasError('required')">
          {{ "FOOD_FORM.IMAGE_PREVIEW" | translate }} is required
        </mat-error>
      </mat-form-field>
    </div>

    <mat-form-field appearance="fill">
      <mat-label>{{ "FOOD_FORM.DESCRIPTION" | translate }}</mat-label>
      <textarea
        matInput
        formControlName="description"
        placeholder="{{ 'FOOD_FORM.DESCRIPTION' | translate }}"
      ></textarea>
      <mat-error
        *ngIf="
          foodForm.get('description').invalid &&
          foodForm.get('description').touched
        "
      >
        {{ "FOOD_FORM.DESCRIPTION_REQUIRED" | translate }}
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>{{ "FOOD_FORM.PRICE" | translate }}</mat-label>
      <input
        matInput
        formControlName="price"
        type="number"
        placeholder="{{ 'FOOD_FORM.PRICE' | translate }}"
      />
      <mat-hint>{{ "FOOD_FORM.PRICE_HINT" | translate }}</mat-hint>
      <mat-error
        *ngIf="foodForm.get('price').invalid && foodForm.get('price').touched"
      >
        {{ "FOOD_FORM.PRICE" | translate }} is required
      </mat-error>
    </mat-form-field>

    <mat-form-field appearance="fill">
      <mat-label>{{ "FOOD_FORM.POPULARITY" | translate }}</mat-label>
      <input
        matInput
        formControlName="popularity"
        placeholder="{{ 'FOOD_FORM.POPULARITY' | translate }}"
      />
      <mat-hint>{{ "FOOD_FORM.POPULARITY_HINT" | translate }}</mat-hint>
      <mat-error
        *ngIf="
          foodForm.get('popularity').invalid &&
          foodForm.get('popularity').touched
        "
      >
        {{ "FOOD_FORM.POPULARITY_REQUIRED" | translate }}
      </mat-error>
    </mat-form-field>

    <div formArrayName="ingredients">
      <div
        *ngFor="
          let food of foodForm.get('ingredients')['controls'];
          let i = index
        "
        [formGroupName]="i"
        class="ingredient-group"
      >
        <mat-form-field appearance="fill">
          <mat-label>Name</mat-label>
          <input matInput formControlName="name" placeholder="Enter name" />
          <mat-error
            *ngIf="food.get('name').invalid && food.get('name').touched"
            >Name is required</mat-error
          >
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Type</mat-label>
          <input matInput formControlName="type" placeholder="Enter type" />
          <mat-error
            *ngIf="food.get('type').invalid && food.get('type').touched"
            >Type is required</mat-error
          >
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Price</mat-label>
          <input
            matInput
            formControlName="price"
            type="number"
            placeholder="Enter price"
          />
          <mat-error
            *ngIf="food.get('price').invalid && food.get('price').touched"
            >Price is required and must be a valid number</mat-error
          >
        </mat-form-field>

        <mat-form-field appearance="fill">
          <mat-label>Amount</mat-label>
          <input
            matInput
            formControlName="amount"
            type="number"
            placeholder="Enter amount"
          />
          <mat-error
            *ngIf="food.get('amount').invalid && food.get('amount').touched"
            >Amount is required and must be a valid number</mat-error
          >
        </mat-form-field>

        <button
          mat-raised-button
          style="margin-bottom: 10px"
          type="button"
          (click)="removeField(i)"
          [disabled]="isFirstField(i)"
        >
          Remove ingredients
        </button>
      </div>
    </div>

    <button
      mat-raised-button
      style="margin-bottom: 10px"
      type="button"
      (click)="addField()"
    >
      Add Ingredients
    </button>
  </div>
  <button mat-raised-button type="submit">Edit</button>
</form>
